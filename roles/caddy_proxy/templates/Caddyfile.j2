{
	# email используется для ACME-аккаунта; с tls internal не критично
	email {{ letsencrypt_email }}
}

# Authentik
{{ auth_fqdn }} {
	tls internal
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
	}
	reverse_proxy http://{{ authentik_upstream }}
}

# Nextcloud
{{ nextcloud_fqdn }} {
	tls internal
	encode zstd gzip
	rewrite /.well-known/carddav /remote.php/dav
	rewrite /.well-known/caldav /remote.php/dav
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
	}
	reverse_proxy http://{{ nextcloud_upstream }}
}

# OnlyOffice
{{ onlyoffice_fqdn }} {
	tls internal
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
	}
	reverse_proxy http://{{ onlyoffice_upstream }}
}
