services:
  onlyoffice:
    image: onlyoffice/documentserver:latest
    container_name: onlyoffice
    environment:
      JWT_ENABLED: "true"
      JWT_SECRET: "{{ onlyoffice_jwt_secret }}"
      JWT_HEADER: "Authorization"
      JWT_IN_BODY: "true"
    volumes:
      - ./data:/var/www/onlyoffice/Data
      - ./log:/var/log/onlyoffice
      - ./lib:/var/lib/onlyoffice
    networks:
      - infra
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://127.0.0.1/healthcheck"]
      interval: 15s
      timeout: 5s
      retries: 20
    restart: unless-stopped

networks:
  infra:
    external: true
    name: {{ docker_infra_network }}
