---
- name: Unmask auto updater services
  become: true
  ansible.builtin.systemd:
    name: "{{ item }}"
    masked: false
  loop:
    - apt-daily.service
    - apt-daily-upgrade.service
    - unattended-upgrades.service
  register: bootstrap_apt_teardown_unmask
  failed_when:
    - bootstrap_apt_teardown_unmask is failed
    - >-
      'Could not find the requested service' not in
      (bootstrap_apt_teardown_unmask.msg | default(''))
  loop_control:
    label: "{{ item }}"

- name: Restart auto updater services
  become: true
  ansible.builtin.systemd:
    name: "{{ item }}"
    state: started
  loop:
    - packagekit
    - apt-daily.service
    - apt-daily-upgrade.service
    - unattended-upgrades.service
  register: bootstrap_apt_teardown_start
  failed_when:
    - bootstrap_apt_teardown_start is failed
    - >-
      'Could not find the requested service' not in
      (bootstrap_apt_teardown_start.msg | default(''))
  loop_control:
    label: "{{ item }}"
